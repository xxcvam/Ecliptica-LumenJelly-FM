# 🎲 音序器智能随机生成指南

## 功能说明

音序器面板现在包含一个 **🎲 骰子按钮**，可以智能地根据当前选择的音阶特性，自动生成一组音乐性强、有趣且可用的音序器模式。

---

## 使用方法

1. **选择音阶**：在音序器面板中选择想要的音阶（如 Japanese、Blues、Major 等）
2. **点击骰子**：点击音阶选择器旁边的 🎲 按钮
3. **生成序列**：系统会根据音阶特性智能生成 16 步序列
4. **调整细节**：点击单个步进可以进一步编辑
5. **再次随机**：不满意？再点击 🎲 生成新的序列

---

## 智能生成算法

### 🎯 根据音阶特性调整

算法会根据不同音阶类型自动调整生成策略：

#### **五声音阶** (5音)
- Japanese, Chinese, Pentatonic 等
- 🎵 **音域跨度**: 更大 (±14 半音)
- 🎵 **音符门限**: 更长 (0.6-0.9)
- 特点：适合悠扬、舒展的旋律

#### **对称音阶**
- Whole Tone, Diminished, Augmented, Octatonic
- 🎵 **音域跨度**: 紧凑 (±8 半音)
- 🎵 **音符门限**: 更短 (0.3-0.7)
- 特点：适合实验性、现代感强的序列

#### **民族音阶**
- Arabic, Gypsy, Spanish, Persian, Jewish
- 🎵 **音域跨度**: 适中 (±10 半音)
- 🎵 **力度变化**: 更大动态范围
- 特点：保留民族音乐的跳跃感和激情

#### **爵士音阶**
- Bebop, Dorian, Mixolydian
- 🎵 **力度**: 更均匀 (70-100)
- 🎵 **节奏**: 更多切分和摇摆感
- 特点：适合即兴和爵士风格

---

## 生成参数说明

### 📊 节奏密度
- **30% - 75%** 的随机步进激活率
- 避免过于密集或稀疏
- 保证音乐的呼吸感

### 🎼 节奏模式
随机选择以下模式之一：
1. **4/4 基础** - 每拍强调一次 (1-0-0-0)
2. **切分** - 错位重音
3. **跳跃** - 不规则节奏
4. **均匀** - 稳定的八分音符
5. **密集** - 快速连续音符

### 🎹 音高生成 (随机游走算法)
- **起点**: 中音域附近 (±2 半音)
- **小跳**: 50% 概率保持，50% 在音阶内小幅移动
- **大跳**: 每 4 步或 30% 概率进行 ±3 半音跳跃
- **限制**: 自动限制在音阶的合理范围内

### 💪 力度 (Velocity)
- **范围**: 60-110 (避免过弱或过强)
- **强拍**: 每 4 步的第 1 步稍微增强 (+10)
- **爵士**: 力度更均匀 (70-100)

### ⏱️ 门限 (Gate)
- **标准**: 0.4 - 0.9 (避免过短或完全连奏)
- **五声**: 稍长 (0.6 - 0.9)
- **对称**: 可更短 (0.3 - 0.7)

### 🎲 概率 (Probability)
- **85%**: 100% 概率
- **15%**: 60-100% 浮动概率 (增加变化)

### 🔁 连奏 (Ratchet)
- **90%**: 单音符
- **10%**: 2 连音或 4 连音 (增加律动)

---

## 实用技巧

### 🎨 创意工作流

1. **快速灵感**
   - 连续点击骰子 3-5 次
   - 选择最有感觉的一个作为起点
   - 手动微调细节

2. **音阶探索**
   - 选择不同音阶（如从 Major → Arabic → Japanese）
   - 每个音阶点击骰子 1-2 次
   - 比较不同文化的音乐感

3. **节奏实验**
   - 固定一个喜欢的旋律
   - 改变 Step Length (1/16, 1/8, 1/8T)
   - 调整 Swing 和 BPM

4. **层次叠加**
   - 生成一个 Bass 线（低音区，少音符）
   - 复制音序器参数到另一个实例
   - 生成一个旋律线（高音区，密集）

### 🎯 按风格生成

#### 环境音乐
- 音阶: Whole Tone, Lydian
- 特点: 骰子生成后，手动减少音符密度

#### 节奏音乐
- 音阶: Pentatonic Minor, Blues
- 特点: 生成后增加 Ratchet (2-4连音)

#### 民族风格
- 音阶: Japanese, Arabic, Gypsy
- 特点: 保留生成的大跳和力度变化

#### 爵士即兴
- 音阶: Bebop, Dorian
- 特点: 增加 Swing 到 40-60%

---

## 不会生成的内容（避免极端）

✅ **保证不出现**:
- ❌ 全部静音的序列
- ❌ 音高跨度超过 2 个八度
- ❌ 力度低于 60 或高于 127
- ❌ 门限低于 0.3 或高于 1.0
- ❌ 过于规则的机械模式
- ❌ 完全随机无音乐性的噪音

✅ **保证出现**:
- ✓ 至少 30% 的音符激活
- ✓ 合理的节奏模式
- ✓ 符合音阶的音高选择
- ✓ 有起伏的力度变化
- ✓ 适当的音符长度

---

## 常见问题

### Q: 为什么每次生成都不一样？
**A**: 这是随机算法的特点，每次都会生成独特的序列。连续点击可以快速筛选满意的结果。

### Q: 可以保存喜欢的序列吗？
**A**: 目前暂不支持保存，但你可以手动记录参数，或在生成后调整细节。

### Q: 某些音阶生成的序列为什么音域较窄？
**A**: 对称音阶（如 Whole Tone）和实验音阶会生成更紧凑的音域，这是为了保持音乐性。

### Q: 如何生成更密集或稀疏的序列？
**A**: 多次点击骰子，选择密度合适的。或生成后手动开关某些步进。

### Q: 爵士音阶和普通音阶有什么区别？
**A**: 爵士音阶（Bebop, Dorian）会生成力度更均匀、节奏更复杂的序列。

---

## 示例应用场景

### 🎬 电影配乐
```
音阶: Prometheus, Whole Tone
操作: 点击🎲，选择稀疏、大跳的序列
调整: 增加 Gate 到 0.8+，降低 BPM 到 60-80
```

### 🎮 游戏音乐
```
音阶: Japanese, Pentatonic
操作: 点击🎲，选择中等密度的序列
调整: 增加 Ratchet，提高 BPM 到 140+
```

### 🎷 爵士即兴
```
音阶: Bebop, Dorian
操作: 点击🎲，保留原样或微调
调整: 设置 Swing 50%, Mode: Random
```

### 💃 电子舞曲
```
音阶: Pentatonic Minor, Blues
操作: 点击🎲 3次，选择最律动的
调整: BPM 120-128, 增加部分 Ratchet
```

### 🌏 世界音乐
```
音阶: Arabic, Gypsy, Chinese
操作: 点击🎲，保留大跳和特征音程
调整: 强化某些步进的 Velocity
```

---

## 开发者说明

### 算法核心
- **随机游走**: 音高不是完全随机，而是从中心点开始逐步移动
- **加权概率**: 强拍概率更高，弱拍有随机性
- **音阶感知**: 根据音阶的音符数量和特征调整参数
- **音乐性优先**: 避免生成极端或不和谐的组合

### 技术实现
- 位置: `fm-web/src/App.tsx` → `handleSequencerRandomize`
- 依赖: SCALE_MAP (音阶定义)
- 触发: SequencerPanel 的 onRandomize 回调

---

**提示**: 🎲 是创作的起点，而非终点。善用随机生成 + 手动调整的组合，可以快速创造出独特的音乐模式！

**版本**: 1.0  
**更新**: 2025-10-28

